<div class="column-layout profile-view-main-layout">
  <div class="column-layout profile-header-section">
    <h4 class="content">
      {{ isAdmin ? 'Admin Profile and Management' : 'My User Profile and History' }}
    </h4>
    <p class="ig-typography__body-2 content">
      {{ isAdmin ? 'View your email, requests, and history as Admin' : 'View your email, requests, and borrowing history' }}
    </p>
  </div>
  <div class="column-layout profile-form-layout">
    <igx-input-group type="box" class="email-input">
      <input type="email" [(ngModel)]="value" igxInput readonly />
      <label igxLabel>Email</label>
    </igx-input-group>
  </div>

  <!-- Admin view with tabs -->
  <div *ngIf="isAdmin" class="column-layout tabs-container">
    <igx-tabs class="full-width-tabs">
      
      <igx-tab-item>
        <igx-tab-header>
          <igx-icon>list_alt</igx-icon>
          <span>My Requests</span>
        </igx-tab-header>
        <igx-tab-content>
          <div class="column-layout my-requests-section">
            <h4 class="request-equipment-title">
              My Equipment Requests
            </h4>
            @if (isLoadingRequests) {
            <div class="loading-indicator">Loading requests...</div>
            }
            <igx-grid [data]="myRequests" primaryKey="id" [allowFiltering]="true" filterMode="excelStyleFilter"
              width="100%" class="grid">
              <igx-column field="id" header="Request ID" [sortable]="true" [filterable]="true"
                width="100px"></igx-column>

              <igx-column field="equipment.name" header="Equipment" [sortable]="true" [filterable]="true" width="200px">
                <ng-template igxCell let-cell="cell">
                  <div class="equipment-info">
                    <strong>{{ cell.row.data.equipment?.name || 'N/A' }}</strong>
                    <br>
                    <small>{{ cell.row.data.equipment?.type || '' }}</small>
                  </div>
                </ng-template>
              </igx-column>

              <igx-column field="requestedAt" header="Requested" [sortable]="true" [filterable]="true" width="120px">
                <ng-template igxCell let-cell="cell">
                  {{ formatDate(cell.value) }}
                </ng-template>
              </igx-column>

              <igx-column field="start" header="Start Date" [sortable]="true" [filterable]="true" width="120px">
                <ng-template igxCell let-cell="cell">
                  {{ formatDate(cell.value) }}
                </ng-template>
              </igx-column>

              <igx-column field="end" header="End Date" [sortable]="true" [filterable]="true" width="120px">
                <ng-template igxCell let-cell="cell">
                  {{ formatDate(cell.value) }}
                </ng-template>
              </igx-column>

              <igx-column field="status" header="Status" [sortable]="true" [filterable]="true" width="120px">
                <ng-template igxCell let-cell="cell">
                  <span [class]="getStatusClass(cell.value)" class="status-badge">
                    {{ cell.value }}
                  </span>
                </ng-template>
              </igx-column>

              <igx-column field="notes" header="Notes" [sortable]="false" [filterable]="true" width="150px">
                <ng-template igxCell let-cell="cell">
                  <span [title]="cell.value">{{ truncateText(cell.value, 50) }}</span>
                </ng-template>
              </igx-column>

              <igx-column field="approvedAt" header="Approved" [sortable]="true" [filterable]="true" width="120px">
                <ng-template igxCell let-cell="cell">
                  {{ cell.value ? formatDate(cell.value) : '-' }}
                </ng-template>
              </igx-column>

              <igx-column field="returnedAt" header="Returned" [sortable]="true" [filterable]="true" width="120px">
                <ng-template igxCell let-cell="cell">
                  {{ cell.value ? formatDate(cell.value) : '-' }}
                </ng-template>
              </igx-column>
            </igx-grid>
          </div>
        </igx-tab-content>
      </igx-tab-item>

      <igx-tab-item>
        <igx-tab-header>
          <igx-icon>history</igx-icon>
          <span>Activity History</span>
        </igx-tab-header>
        <igx-tab-content>
          <div class="column-layout borrowing-history-section">
            <h4 class="request-equipment-title">
              Activity History
            </h4>
            @if (isLoadingHistory) {
            <div class="loading-indicator">Loading history...</div>
            }
            <igx-grid [data]="activityHistory" [allowFiltering]="true" filterMode="excelStyleFilter" height="400px"
              width="100%" class="activity-grid">

              <igx-column field="id" header="ID" [sortable]="true" [filterable]="true" ></igx-column>

              <igx-column field="action" header="Action" [sortable]="true" [filterable]="true" >
                <ng-template igxCell let-cell="cell">
                  <span [class]="getActionClass(cell.value)" class="action-badge">
                    {{ cell.value }}
                  </span>
                </ng-template>
              </igx-column>

              <igx-column field="equipmentId" header="Equipment ID" [sortable]="true" [filterable]="true"
                ></igx-column>

              <igx-column field="userId" header="User " [sortable]="true" [filterable]="true"
                ></igx-column>

              <igx-column field="timestamp" header="Date & Time" [sortable]="true" [filterable]="true" >
                <ng-template igxCell let-cell="cell">
                  {{ formatDate(cell.value) }}
                </ng-template>
              </igx-column>

              <igx-column field="notes" header="Details" [sortable]="false" [filterable]="true">
                <ng-template igxCell let-cell="cell">
                  <span [title]="cell.value">{{ cell.value || '-' }}</span>
                </ng-template>
              </igx-column>
            </igx-grid>
          </div>
        </igx-tab-content>
      </igx-tab-item>
    </igx-tabs>
  </div>

  <!-- Regular user view with tabs -->
  <div *ngIf="!isAdmin" class="column-layout tabs-container">
    <igx-tabs class="full-width-tabs">
      <igx-tab-item>
        <igx-tab-header>
          <igx-icon>list_alt</igx-icon>
          <span>My Requests</span>
        </igx-tab-header>
        <igx-tab-content>
          <div class="column-layout my-requests-section">
            <h4 class="request-equipment-title">
              My Equipment Requests
            </h4>
            @if (isLoadingRequests) {
            <div class="loading-indicator">Loading requests...</div>
            }
            <igx-grid [data]="myRequests" primaryKey="id" [allowFiltering]="true" filterMode="excelStyleFilter"
              width="100%" class="grid">
              <igx-column field="id" header="Request ID" [sortable]="true" [filterable]="true"
                width="100px"></igx-column>

              <igx-column field="equipment.name" header="Equipment" [sortable]="true" [filterable]="true" width="200px">
                <ng-template igxCell let-cell="cell">
                  <div class="equipment-info">
                    <strong>{{ cell.row.data.equipment?.name || 'N/A' }}</strong>
                    <br>
                    <small>{{ cell.row.data.equipment?.type || '' }}</small>
                  </div>
                </ng-template>
              </igx-column>

              <igx-column field="requestedAt" header="Requested" [sortable]="true" [filterable]="true" width="120px">
                <ng-template igxCell let-cell="cell">
                  {{ formatDate(cell.value) }}
                </ng-template>
              </igx-column>

              <igx-column field="start" header="Start Date" [sortable]="true" [filterable]="true" width="120px">
                <ng-template igxCell let-cell="cell">
                  {{ formatDate(cell.value) }}
                </ng-template>
              </igx-column>

              <igx-column field="end" header="End Date" [sortable]="true" [filterable]="true" width="120px">
                <ng-template igxCell let-cell="cell">
                  {{ formatDate(cell.value) }}
                </ng-template>
              </igx-column>

              <igx-column field="status" header="Status" [sortable]="true" [filterable]="true" width="120px">
                <ng-template igxCell let-cell="cell">
                  <span [class]="getStatusClass(cell.value)" class="status-badge">
                    {{ cell.value }}
                  </span>
                </ng-template>
              </igx-column>

              <igx-column field="notes" header="Notes" [sortable]="false" [filterable]="true" width="150px">
                <ng-template igxCell let-cell="cell">
                  <span [title]="cell.value">{{ truncateText(cell.value, 50) }}</span>
                </ng-template>
              </igx-column>

              <igx-column field="approvedAt" header="Approved" [sortable]="true" [filterable]="true" width="120px">
                <ng-template igxCell let-cell="cell">
                  {{ cell.value ? formatDate(cell.value) : '-' }}
                </ng-template>
              </igx-column>

              <igx-column field="returnedAt" header="Returned" [sortable]="true" [filterable]="true" width="120px">
                <ng-template igxCell let-cell="cell">
                  {{ cell.value ? formatDate(cell.value) : '-' }}
                </ng-template>
              </igx-column>
            </igx-grid>
          </div>
        </igx-tab-content>
      </igx-tab-item>

      <igx-tab-item>
        <igx-tab-header>
          <igx-icon>history</igx-icon>
          <span>Activity History</span>
        </igx-tab-header>
        <igx-tab-content>
          <div class="column-layout borrowing-history-section">
            <h4 class="request-equipment-title">
              Activity History
            </h4>
            @if (isLoadingHistory) {
            <div class="loading-indicator">Loading history...</div>
            }
            <igx-grid [data]="activityHistory" primaryKey="id" [allowFiltering]="true" filterMode="excelStyleFilter"
              width="100%" class="grid">
              <igx-column field="id" header="ID" [sortable]="true" [filterable]="true" width="80px"></igx-column>

              <igx-column field="action" header="Action" [sortable]="true" [filterable]="true" width="150px">
                <ng-template igxCell let-cell="cell">
                  <span [class]="getActionClass(cell.value)" class="action-badge">
                    {{ cell.value }}
                  </span>
                </ng-template>
              </igx-column>

              <igx-column field="equipmentName" header="Equipment" [sortable]="true" [filterable]="true"
                width="200px"></igx-column>

              <igx-column field="userName" header="User" [sortable]="true" [filterable]="true"
                width="150px"></igx-column>

              <igx-column field="timestamp" header="Date & Time" [sortable]="true" [filterable]="true" width="150px">
                <ng-template igxCell let-cell="cell">
                  {{ formatDate(cell.value) }}
                </ng-template>
              </igx-column>

              <igx-column field="details" header="Details" [sortable]="false" [filterable]="true" width="250px">
                <ng-template igxCell let-cell="cell">
                  <span [title]="cell.value">{{ cell.value || '-' }}</span>
                </ng-template>
              </igx-column>
            </igx-grid>
          </div>
        </igx-tab-content>
      </igx-tab-item>
    </igx-tabs>
  </div>
</div>